\chapter{Methods}

This thesis is the third and final part of a three semester project. The
substance of the past two theses was to build a foundation for the incorporation
of \mss{} and \ogs{}. 

The first project thesis consists of mostly literature about the topics \ogs{}
and \mss{}. The result is a comprehensive documentation of these two topics. The
essence of the document is the descriptions of a set of artifact that are
required to produce a fully functional \og{}.

During the second project thesis the theory established in thesis one was put
into practice. This was realized by implementing a prototype with the minimal
set of artifacts that are required to showcase the feasibility of \og{}
development with \mss{}. The results of the second project theses is a
feasibility study along with a fully functional prototype of an \og{} build
with \mss{}.

This third and final thesis is mainly about the elaboration of the previous tho
theses. This includes the examination of the open research problems listed in
\autoref{sub:problems} and the finalization of the prototype that was initially
developed during the second project thesis. This prototype serves as a reference
on how to develop and operate \ogs{} using a \mss{} environment.

\section{Subject Pool}
\label{sec:subject_pool}

The research problems that this thesis aims to solve are very variegated. To
gain an overview over all the activities that have to be conducted in the course
of this thesis the research problems can be collated to concrete subjects. These
subjects can then be examined individually.

\subsection{\ms{} Tenets in Relation to Online Games}

This is the major subject of this thesis and will therefore receive a lot of
attention. The research goal of this subject is to research every \ms{} tenet
according to its requirements in regards to \ogs{}. This is done in the form of
a requirements analysis of every tenet and a proposal on how to suffice them.
Examples for these solutions are implemented in the prototype and serve as a
demonstration. \todo{Ref to Result Section}

\subsection{Challenges Introduced by \mss{}}

It is challenging to suffice all \ms{} tenets for \og{} development. Most
noticeable the IDEAL tenet on specifically isolated state represents the biggest
challenge. This is because a game is always stateful. For example the location
of all chess pieces on a chess board is the state of the chess game. Since
\mss{} are always stateless the full game state must be sent with every game
message to provide true service confinement. In a simple game like chess this
might be possible but in a rich \og{} this is just no feasible. 

This challenge also exists in other computer science disciplines and is called
session management. In the case of \ogs{} sessions of players have to be
tracked but also the sessions of the game itself (e.g. one round of chess).

This challenge leads to another challenge namely game model access. Since the
game state is shared among multiple \mss{} a flexible approach is needed to
provide access to session data to the services.

The remaining challenges have already been discussed in the previous two project
theses.

\subsection{\ms{} Infrastructure}

The \ms{} infrastructure subject is a collection of all topics that have to be
considered when operating a \ms{} environment. The content of this subject is
not restricted to the \ogs{} and can be applied to any domain.

\subsubsection{Requirements for \ms{} Composition}

The examination of the requirements for \ms{} composition can be grouped into
logical and physical composition (explained in \autoref{subsub:composition})
requirements.

The requirements for physical composition of \ms{} \og{} environments are very
similar to the requirements of classical business applications. The article of
O.Wolf provides a very good overview of the aspects of \ms{} composition and
discusses the paradigms orchestration and choreography in detail \cite{wolf_ms}.
Also C.Pahl and B.Lee provide a comprehensive paper that discusses requirements
to compose containerized applications in the cloud \cite{pahl2015containers}.

The requirements for logical composition are in essence very simple. Physical
composition offers a way for \mss{} to find each other. Logical composition is
on top of physical composition responsible that the services understand each
other.

\subsubsection{Deployment of a \ms{} Environment}

The deployment topic contains all aspects that have to be considered when a
production environment for a \ms{} application is realized. This includes the
continuous integration process that is responsible to build the application code
and deploy the executable files to the production environment.

Deployment also covers the aspect of choosing an appropriate cloud service
provider to that provides the physical infrastructure for the production
environment.

\subsubsection{Service Persistence}

The polyglot persistence approach proposed for \mss{} is only partially usable.
This is because a large portion of the state data (for example player data)
is essentially used by every service. With polyglot persistence only one
\ms{} would have direct access to this frequently requested data. This
inevitably leads to a bottle neck.

\paragraph{Durability}

In \ms{} environments databases are often deployed as \mss{} themselves.
Therefor it is in fact possible to loose the data stored in the containers. To
cope with this a durable solution is needed that adds a layer of redundancy to
guarantee that no data is lost. 

\subsubsection{Service Consistency}

One omnipresent problem with distribution is data consistency throughout the
application. For \ogs{} consistency is not as critical as like in for example
the medical industry but still undesirable. Also usually it is possible to spend
real money in an \og{} and therefore strong consistency is required for parts of
the application. 

\subsubsection{Service Monitoring}

In order to keep track on the health of a \ms{} application it is mandatory to
have live information on the status of the application. This includes a
visualization of the overall performance of the whole system and also for
individual services.

This topic also includes notification on events happening in the system like for
example notifications on system failure or regular operational reports. 

\subsection{Networking in \ogs{}}

Networking is obviously a critical part of \og{} development. it is important
that developers understand which implications the networked functionality has
on the game. Networking in video games is a well documented subject. An
essential reference for networking in \ogs{} is the blog of G.Gambetta\cite{}
about fast-paced multi-player. It is a great reference to understand the low
level aspects of networking in games.


\subsection{Development of a \ms{} Driven Online Game}

\subsection{Procedural Content Generation in Online Games}
























\section{Instrumentation}

\subsection{Available Technology}

\subsubsection{Cloud Service Provider}

MicroNet is designed to run in the cloud. It is therefore mandatory to evaluate
the major cloud service infrastructure providers according to their usability
for online games.

One problem in regards to these service providers is payment. Although they
provide a free tier to test their infrastructure, a credit card has to be
pledged as security. In the case the limit is overdrawn a fee will be charged.
This risk cannot be taken in this thesis. 

\paragraph{Google Cloud Gaming Solutions}

Google offers a solution to deploy rich online games in the cloud. It basically
a setup for the existing google cloud infrastructure with additional
functionality to to provide build in matchmaking matchmaking. For this purpose
it provides an API that is available in a number of programming languages.

The MicroNet service that provides the matchmaking functionality has to be
altered if the Google solution for matchmaking wants to be used. 

To operate a game driven by MicroNet in the Google Cloud the Google App Engine
can be used to run the services of the MicroNet framework and the Google Compute
Engine can be used to run the game simulation servers. ActiveMQ that is used for
messaging can be used with Google Cloud by using Bitnami.

\paragraph{Amazon Game Lift}

Amazon GameLift is very similar to Google Gaming Solutions. It also provides a
matchmaking solution and the option to communicate with the game backend running
in the Amazon cloud. An advantage of the amazon solution is that it provides an
API for all the major game engines like Unity3D or Unreal Engine 4. Amazon also
provides its own game engine with the name Lumberyard.

\paragraph{A Dedicated Server}

The most general way to deploy the MicroNet framework is on a dedicated server
hardware. This could be either a cluster of bare metal servers with a sufficient
networking capabilities or a set of virtual servers running somewhere in the
cloud. Either way the result is a set of hosts running linux and have a public
ip address.

For this thesis a virtual server at the HSR will be the test setup. This
infrastructure is also available at the major cloud service providers.

\paragraph{Docker}

Docker is a very powerful paradigm to run software. Instead of installing a
software on a host and running it native it is packaged in a container and a
container engine on the host is running it instead. This greatly eases the
deployment of software since the developer can run it anywhere as long as it
runs in Docker.\\

Docker is the foundation for the easy deployment of MicroNet. It is used to hide
all the dependencies that the framework has from the developer. This is possible
because to all major dependencies of the Framework dockerhub provides reference
containers that can be used to deploy features. This goes for all dependencies
namely speaking: ActiveMQ containers and Postgres containers. Since the
framework is written in Java developers can simply use openJDK containers to
easily deploy their own services.\\

It is also possible to let a \ms{} participate in the framework that is not
running in docker. in that case it can simply communicate with the framework
over the message broker from any host.\\

Another interesting docker container is hydra which provides a OAuth2 and
OpenID implementation. It can be used to make the framework and the game more
secure. But this might be overkill for the system that is aimed to be small and
simple. It is easier to use the ActiveMQ security functionality instead.\\

\paragraph{Docker Compose}

Docker Compose is a way to describe a complex application consisting of multiple
Docker containers. This approach is used to deploy the whole MicroNet framework
with one click. Is is possible to automatically update the docker-compose file
at compile-time and therefore keep the deployment description in sync with the
framework code.

Docker Compose is also the foundation for the usage of Docker Swarm. With docker
Swarm a Docker application can be distributed on multiple hosts. 

\paragraph{Docker for Windows}

One requirement for game development is the support for Windows development
machines. Since Windows is the most-widely used development OS for games it is
mandatory that MicroNet can be fully developed with a Windows machine. 

The Docker for Windows Version feels very close to the native version on Linux.
One problem regarding Docker for Windows is that it does not run native an on
all Windows versions since HyperV is required for it to work. As a work-around
Tocker Tools can be used but this makes the deployment process more complicated.

\subsubsection{Maven}

Apache Maven is a build tool for Java Programs. It defines a build process that
includes running tests and finally deploying to program in a repository. Maven
helps to build a bridge between the actual code of a service and the integration
into the framework. For this purpose it a build script format that defines the
dependencies and additional build instructions. This makes it possible do
abstract the manual installation process of MicroNet. 

So spare the developer of an online game to cope with the edit complicated Maven
scripts (.pom files) these pon files are generated by the eclipse MicroNet
tools.

\subsection{Design Science Methodology}
\subsection{Vertical Slice Prototype}



















\section{Procedures}

\section{Method Selection for Research Problems}

The subject pool discussed in \autoref{sec:subject_pool} are very variegated.
For the examination of the subjects it is therefor necessary to access each
subject with in a specifically suited method. The research problems can be
summarized into four problem domains which allows to choose the the optimal
research method for each domain individually.

\subsection{Composition}
Expert Opinion on Model Approach

\subsection{Deployment}
Evaluation of 3rd party libraries (DevOps work)


\subsection{Development}
Expert Opinion

A one click solution for developers to start with online game
  	  development. The development process should feel as closely as possible to
  	  offline game development.

\subsection{Operations}
Play Tests

\subsection{Lab Research}

\subsection{Eclipse}

Since MicroNet makes usage of various thirs party libraries and tools there
needs to be a way to manage them all. This purpose solves the Eclipse tools for
MicroNet. The MicroNet Tools is a set of plug-ins that are partially independent
of each other. They all help the developer to implement game specific \mss{}.

Since the UI of an Eclipse plug-in is written with the SWT library it can easily
be exported to a standalone tool that does not require Eclipse. However any code
related feature do require the Eclipse IDE.

\subsubsection{Service Generation}

Allows the developer to not worry about boiler plate code of setting up the
service in the framework. This covers the setup of the appropriate networking
solution according to the environment. This allows the developer to focus on the
actual service code.

\subsubsection{Code Assist}

The Code Assist plug-in helps the developer to keep track of functionality
provided by other services. It allows a type-safe communication between
services. The information that is needed to give these API proposals is
extracted from the service implementation at compile time. The information is
then shared via the version control system. This process is manually and the
developer must check in and probably merge his changes. 

The format of the distribute API description is not relevant because it is a
machine-readable format and the developer sees it in a polished form.

\subsubsection{Management UI}

The management UI plug-in helps the developer to get an overview over the whole
game application. It helps the manage the versions of services of the game
services as well as the versions of dependencies. This plug-in highly relies on
the description of the maven projects.

\subsection{Field Research}

\section{Statistical Analysis}

The results of the previous semesters are to this point only of hypothetical
nature. The main goal this semester is therefore to validate the findings up to
now.\\

Validation for the run-time aspect of the solution:

\begin{enumerate}
  \item To prove that the solution holds in regard to run-time is necessary to
  give proper validation feedback for the combination of Microservices and
  Online Games. It must be shown the running framework is able to scale at
  run-time. In a first instance this is done by performing lab-research in the
  form of small scale play test with some elected test players.
  \item One more sophisticated approach is to perform TAR on the run-time
  validation. This would mean to test the MicroNet with the alpha version of the
  Spacegame prototype in a long running tests that is available for the public. 
\end{enumerate}

Validation of the development-time aspect of the solution:

\begin{enumerate}
  \item It must be proven that the proposed development solution is actually
  usable and as simple as proposed.
\end{enumerate}

This validation research is made according to design science methods and
teminology.